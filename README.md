# Creating a Live SOC Honeynet in Azure
![Cloud Honeynet / SOC](https://i.imgur.com/5JqcZ0B.png)

## Introduction and Objective


In this project, a small-scale honeynet was established on the Azure platform. The primary aim was to collect and analyze logs from various sources, which were then centralized within a Log Analytics workspace. Microsoft Sentinel was implemented to harness these logs for tasks such as constructing attack maps, setting up alert mechanisms, and generating incident reports. Azure Sentinel was utilized to assess the security status of the environment over a 24-hour period. Subsequently, security measures were enforced to bolster the virtual infrastructure. Following this phase, another 24-hour evaluation period was conducted to gauge the effectiveness of the implemented controls. The findings from these activities are detailed below, focusing on the analysis of the following metrics:

- SecurityEvent (Windows Event Logs)
- Syslog (Linux Event Logs)
- SecurityAlert (Log Analytics Alerts Triggered)
- SecurityIncident (Incidents generated by Sentinel)
- AzureNetworkAnalytics_CL (Identification of Malicious Flows permitted into the honeynet)


## Technologies, Azure Components, and Regulations Employed
- Azure Virtual Network (VNet)
- Azure Network Security Groups (NSG)
- Virtual Machines (2 Windows VMs, 1 Linux VM)
- Log Analytics Workspace with Kusto Query Language (KQL) Queries
- Azure Key Vault for Secure Secrets Management
- Azure Storage Account for Data Storage
- Microsoft Sentinel for Security Information and Event Management (SIEM)
- Microsoft Defender for Cloud to Protect Cloud Resources
- Windows Remote Desktop for Remote Access
- Command Line Interface (CLI) for System Management
- PowerShell for Automation and Configuration Management
- [NIST SP 800-53 Revision 5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final) for Security Controls
- [NIST SP 800-61 Revision 2](https://www.nist.gov/privacy-framework/nist-sp-800-61) for Incident Handling Guidance


## Architecture BEFORE Hardening and Implementing Security Controls
![Architecture Diagram](https://i.imgur.com/sISxBoj.png)
In the initial phase of the project, known as the "BEFORE" stage, a virtual environment was established and made accessible to the public, inviting malicious actors to explore it. The purpose of this stage was to attract potential threats and observe their methods of attack. To achieve this objective, a Windows virtual machine running a SQL database and a Linux server were deployed, both with their network security groups (NSGs) set to Allow All, essentially granting unrestricted access. Additionally, to further entice potential attackers, a storage account and key vault were created with public endpoints, making them visible on the internet. Throughout this phase, the unsecured environment was monitored by Microsoft Sentinel, which utilized logs collected and aggregated by the Log Analytics workspace.


## Architecture AFTER Hardening and Implementing Security Controls
![Architecture Diagram](https://i.imgur.com/EnWb3Jd.png)
During the "AFTER" stage of the project, the environment was hardened and security controls were implemented in order to satisfy NIST SP 800-53 Rev4 SC-7(3) Access Points. These hardening tactics included:

- **Network Security Groups (NSGs)**: NSGs were hardened by blocking all inbound and outbound traffic with the exception of designated public IP addresses that required access to the virtual machines. This ensured that only authorized traffic from a trusted source was allowed to access the virtual machines.

- **Built-in Firewalls**: Azure's built-in firewalls were configured on the virtual machines to restrict unauthorized access and protect the resources from malicious connections. This step involved fine-tuning the firewall rules based on the service and responsibilities of each VM which mitigated the attack surface bad actors had access to.

- **Private Endpoints**: To enhance the security of Azure Key Vault and Storage Containers, Public Endpoints were replaced with Private Endpoints. This ensured that access to these sensitive resources was limited to the virtual network and not the public internet.



## Attack Maps Before Hardening / Security Controls
<b>This attack map shows the traffic allowed by a Network Security Group with all traffic allowed inbound</b>
![NSG Allowed Inbound Malicious Flows](https://i.imgur.com/A8yxZD7.png)<br>

<b>This attack map shows all the attempts malicious actors attempting to access the Linux virtual machine</b>
![Linux Syslog Auth Failures](https://i.imgur.com/IzAX4vw.png)<br>

 <b>This attack map shows all the attempts malicious actors attempting to access the Windows virtual machine</b>
![Windows RDP/SMB Auth Failures](https://i.imgur.com/w3eIqU8.png)<br>


## Metrics Before Hardening / Security Controls
The following table shows the metrics measured within the unsecured environment for 24 hours:
Start Time 2024-02-07 18:16:08
Stop Time 2024-02-08  18:16:08

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 29061
| Syslog                   | 3163
| SecurityAlert            | 4
| SecurityIncident         | 162
| AzureNetworkAnalytics_CL | 2364


## Metrics After Hardening / Security Controls

```All map queries actually returned no results due to no instances of malicious activity for the 24-hour period after hardening.```

The following table shows the metrics measured in the environment for another 24 hours after applying security controls:
Start Time 2024-02-08 10:00:00
Stop Time	2024-02-08 10:00:00

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 5507
| Syslog                   | 2
| SecurityAlert            | 0
| SecurityIncident         | 0
| AzureNetworkAnalytics_CL | 0

## Conclusion

Throughout the project, the team honed and applied a range of acquired skills and knowledge to effectively secure the environment and meet compliance standards. The "AFTER" stage underscored the team's capacity to implement robust security measures in alignment with NIST SP 800-53 Rev4 SC-7(3) Access Points. These skills were prominently showcased in the meticulous hardening of Network Security Groups (NSGs), fine-tuning of built-in firewalls, and strategic deployment of Private Endpoints. This phase not only demonstrated the team's proficiency in security best practices but also highlighted their ability to adapt learned skills to real-world scenarios, ensuring the integrity and resilience of the environment.
